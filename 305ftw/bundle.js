var app=function(){"use strict";function t(){}function e(t,e){for(const n in e)t[n]=e[n];return t}function n(t){return t()}function r(){return Object.create(null)}function c(t){t.forEach(n)}function o(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function l(t,e){t.appendChild(e)}function a(t,e,n){t.insertBefore(e,n||null)}function i(t){t.parentNode.removeChild(t)}function u(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function d(t){return document.createElement(t)}function f(t){return document.createTextNode(t)}function p(){return f(" ")}function m(){return f("")}function v(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function h(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function k(t){return""===t?void 0:+t}function g(t,e){e=""+e,t.data!==e&&(t.data=e)}function b(t,e,n){t.classList[n?"add":"remove"](e)}let y;function $(t){y=t}function x(t){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(t)}const _=[],C=[],S=[],T=[],E=Promise.resolve();let j=!1;function w(t){S.push(t)}function N(){const t=new Set;do{for(;_.length;){const t=_.shift();$(t),O(t.$$)}for(;C.length;)C.pop()();for(let e=0;e<S.length;e+=1){const n=S[e];t.has(n)||(n(),t.add(n))}S.length=0}while(_.length);for(;T.length;)T.pop()();j=!1}function O(t){t.fragment&&(t.update(t.dirty),c(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(w))}const P=new Set;let A;function B(t,e){t&&t.i&&(P.delete(t),t.i(e))}function F(t,n){const r=n.token={};function o(t,o,s,l){if(n.token!==r)return;n.resolved=s&&{[s]:l};const a=e(e({},n.ctx),n.resolved),i=t&&(n.current=t)(a);n.block&&(n.blocks?n.blocks.forEach((t,e)=>{e!==o&&t&&(A={r:0,c:[],p:A},function(t,e,n,r){if(t&&t.o){if(P.has(t))return;P.add(t),A.c.push(()=>{P.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}(t,1,1,()=>{n.blocks[e]=null}),A.r||c(A.c),A=A.p)}):n.block.d(1),i.c(),B(i,1),i.m(n.mount(),n.anchor),N()),n.block=i,n.blocks&&(n.blocks[o]=i)}if((s=t)&&"object"==typeof s&&"function"==typeof s.then){if(t.then(t=>{o(n.then,1,n.value,t)},t=>{o(n.catch,2,n.error,t)}),n.current!==n.pending)return o(n.pending,0),!0}else{if(n.current!==n.then)return o(n.then,1,n.value,t),!0;n.resolved={[n.value]:t}}var s}function L(t,e){t.$$.dirty||(_.push(t),j||(j=!0,E.then(N)),t.$$.dirty=r()),t.$$.dirty[e]=!0}function z(e,s,l,a,i,u){const d=y;$(e);const f=s.props||{},p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:i,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:r(),dirty:null};let m=!1;var v;p.ctx=l?l(e,f,(t,n)=>{p.ctx&&i(p.ctx[t],p.ctx[t]=n)&&(p.bound[t]&&p.bound[t](n),m&&L(e,t))}):f,p.update(),m=!0,c(p.before_update),p.fragment=a(p.ctx),s.target&&(s.hydrate?p.fragment.l((v=s.target,Array.from(v.childNodes))):p.fragment.c(),s.intro&&B(e.$$.fragment),function(t,e,r){const{fragment:s,on_mount:l,on_destroy:a,after_update:i}=t.$$;s.m(e,r),w(()=>{const e=l.map(n).filter(o);a?a.push(...e):c(e),t.$$.on_mount=[]}),i.forEach(w)}(e,s.target,s.anchor),N()),$(d)}class G{$destroy(){var e,n;n=1,(e=this).$$.fragment&&(c(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function J(t,e,n){const r=Object.create(t);return r.event=e[n],r}function U(t,e,n){const r=Object.create(t);return r.track=e[n],r}function M(e){var n,r;return{c(){(n=d("button")).textContent="Find backend",h(n,"class","svelte-1tg273s"),r=v(n,"click",e.getBackend)},m(t,e){a(t,n,e)},p:t,d(t){t&&i(n),r()}}}function q(t){var e,n,r,o,s,l,u;return{c(){(e=d("button")).textContent="Get tracks from watch",n=p(),r=d("input"),o=f("days ago until\n  "),s=d("input"),l=f("days ago"),h(e,"class","svelte-1tg273s"),h(r,"type","number"),h(r,"min","0"),h(r,"size","1"),h(s,"type","number"),h(s,"min","0"),h(s,"size","1"),u=[v(e,"click",t.getTracks),v(r,"input",t.input0_input_handler),v(s,"input",t.input1_input_handler)]},m(c,i){a(c,e,i),a(c,n,i),a(c,r,i),r.value=t.fromdays,a(c,o,i),a(c,s,i),s.value=t.todays,a(c,l,i)},p(t,e){t.fromdays&&(r.value=e.fromdays),t.todays&&(s.value=e.todays)},d(t){t&&(i(e),i(n),i(r),i(o),i(s),i(l)),c(u)}}}function D(e){return{c:t,m:t,d:t}}function H(e){return{c:t,m:t,d:t}}function W(t){var e,n;return{c(){e=d("i"),n=f("Fetching GPS data from watch"),h(e,"class","fas fa-spinner fa-spin")},m(t,r){a(t,e,r),a(t,n,r)},d(t){t&&(i(e),i(n))}}}function I(t){var e,n,r;return{c(){e=d("article"),n=f("An error occurred:\n"),r=f(t.error),h(e,"class","svelte-1tg273s")},m(t,c){a(t,e,c),l(e,n),l(e,r)},p(t,e){t.error&&g(r,e.error)},d(t){t&&i(e)}}}function K(e){return{c:t,m:t,p:t,d:t}}function Q(t){var e,n;function r(){return t.click_handler(t)}return{c(){(e=d("button")).textContent="Check livelox",h(e,"class","svelte-1tg273s"),n=v(e,"click",r)},m(t,n){a(t,e,n)},p(e,n){t=n},d(t){t&&i(e),n()}}}function R(t){var e,n,r,c=t.selectedtrack===t.track.id&&V();return{c(){(e=d("button")).textContent="Check livelox",n=p(),c&&c.c(),r=m(),e.disabled=!0,h(e,"class","svelte-1tg273s")},m(t,o){a(t,e,o),a(t,n,o),c&&c.m(t,o),a(t,r,o)},p(t,e){e.selectedtrack===e.track.id?c||((c=V()).c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(t){t&&(i(e),i(n)),c&&c.d(t),t&&i(r)}}}function V(t){var e;return{c(){h(e=d("i"),"class","fas fa-spinner fa-pulse")},m(t,n){a(t,e,n)},d(t){t&&i(e)}}}function X(t){var n,r,c,o,s,u,m,v,k,y,$,x,_=t.track.starttime,C=t.track.dur_min,S=String(t.track.dur_sec).padStart(2,"0");let T={ctx:t,current:null,token:null,pending:R,then:Q,catch:K,value:"null",error:"null"};return F($=t.trackpromise,T),{c(){n=d("tr"),r=d("td"),c=f(_),o=p(),s=d("td"),u=f(C),m=f(":"),v=f(S),k=p(),y=d("td"),T.block.c(),x=p(),h(r,"class","svelte-1tg273s"),h(s,"class","svelte-1tg273s"),h(y,"class","svelte-1tg273s"),h(n,"class","svelte-1tg273s"),b(n,"active",t.selectedtrack===t.track.id)},m(t,e){a(t,n,e),l(n,r),l(r,c),l(n,o),l(n,s),l(s,u),l(s,m),l(s,v),l(n,k),l(n,y),T.block.m(y,T.anchor=null),T.mount=(()=>y),T.anchor=null,l(n,x)},p(r,o){t=o,r.tracks&&_!==(_=t.track.starttime)&&g(c,_),r.tracks&&C!==(C=t.track.dur_min)&&g(u,C),r.tracks&&S!==(S=String(t.track.dur_sec).padStart(2,"0"))&&g(v,S),T.ctx=t,"trackpromise"in r&&$!==($=t.trackpromise)&&F($,T)||T.block.p(r,e(e({},t),T.resolved)),(r.selectedtrack||r.tracks)&&b(n,"active",t.selectedtrack===t.track.id)},d(t){t&&i(n),T.block.d(),T.token=null,T=null}}}function Y(e){return{c:t,m:t,p:t,d:t}}function Z(t){var e,n;function r(){return t.click_handler_1(t)}return{c(){(e=d("button")).textContent="Upload to this event",h(e,"class","svelte-1tg273s"),n=v(e,"click",r)},m(t,n){a(t,e,n)},p(e,n){t=n},d(t){t&&i(e),n()}}}function tt(t){var e,n,r,c=t.selectedevent===t.event.id&&et();return{c(){(e=d("button")).textContent="Upload to this event",n=p(),c&&c.c(),r=m(),e.disabled=!0,h(e,"class","svelte-1tg273s")},m(t,o){a(t,e,o),a(t,n,o),c&&c.m(t,o),a(t,r,o)},p(t,e){e.selectedevent===e.event.id?c||((c=et()).c(),c.m(r.parentNode,r)):c&&(c.d(1),c=null)},d(t){t&&(i(e),i(n)),c&&c.d(t),t&&i(r)}}}function et(t){var e;return{c(){h(e=d("i"),"class","fas fa-spinner fa-pulse")},m(t,n){a(t,e,n)},d(t){t&&i(e)}}}function nt(t){var n,r,c,o,s,u,m,v,k,y=t.event.eventname,$=t.event.name;let x={ctx:t,current:null,token:null,pending:tt,then:Z,catch:Y,value:"null",error:"null"};return F(v=t.confirmpromise,x),{c(){n=d("tr"),r=d("td"),c=f(y),o=f(", "),s=f($),u=p(),m=d("td"),x.block.c(),k=p(),h(r,"class","svelte-1tg273s"),h(m,"class","svelte-1tg273s"),h(n,"class","svelte-1tg273s"),b(n,"active",t.selectedevent===t.event.id)},m(t,e){a(t,n,e),l(n,r),l(r,c),l(r,o),l(r,s),l(n,u),l(n,m),x.block.m(m,x.anchor=null),x.mount=(()=>m),x.anchor=null,l(n,k)},p(r,o){t=o,r.events&&y!==(y=t.event.eventname)&&g(c,y),r.events&&$!==($=t.event.name)&&g(s,$),x.ctx=t,"confirmpromise"in r&&v!==(v=t.confirmpromise)&&F(v,x)||x.block.p(r,e(e({},t),x.resolved)),(r.selectedevent||r.events)&&b(n,"active",t.selectedevent===t.event.id)},d(t){t&&i(n),x.block.d(),x.token=null,x=null}}}function rt(e){var n,r,c,o,s,f,m,v,k,g,b,y,$,x,_,C,S,T;function E(t){return t.backend?q:M}var j=E(e),w=j(e);let N={ctx:e,current:null,token:null,pending:W,then:H,catch:D,value:"null",error:"null"};F(s=e.gpspromise,N);for(var O=e.error&&I(e),P=e.tracks,A=[],B=0;B<P.length;B+=1)A[B]=X(U(e,P,B));var L=e.events,z=[];for(B=0;B<L.length;B+=1)z[B]=nt(J(e,L,B));return{c(){(n=d("h1")).textContent="305FTW: automates garmin-USB to livelox.com",r=p(),w.c(),c=p(),o=d("div"),N.block.c(),f=p(),O&&O.c(),m=p(),(v=d("h3")).textContent="Tracks",k=p(),g=d("table"),(b=d("thead")).innerHTML='<tr class="svelte-1tg273s"><th class="svelte-1tg273s">Start</th> <th class="svelte-1tg273s">Duration</th> <th class="svelte-1tg273s"></th></tr>',y=p(),$=d("tbody");for(var t=0;t<A.length;t+=1)A[t].c();x=p(),(_=d("h3")).textContent="Events",C=p(),S=d("table"),T=d("tbody");for(t=0;t<z.length;t+=1)z[t].c();h(n,"class","svelte-1tg273s"),h(g,"class","svelte-1tg273s"),h(S,"class","svelte-1tg273s")},m(t,e){a(t,n,e),a(t,r,e),w.m(t,e),a(t,c,e),a(t,o,e),N.block.m(o,N.anchor=null),N.mount=(()=>o),N.anchor=null,a(t,f,e),O&&O.m(t,e),a(t,m,e),a(t,v,e),a(t,k,e),a(t,g,e),l(g,b),l(g,y),l(g,$);for(var s=0;s<A.length;s+=1)A[s].m($,null);a(t,x,e),a(t,_,e),a(t,C,e),a(t,S,e),l(S,T);for(s=0;s<z.length;s+=1)z[s].m(T,null)},p(t,n){if(j===(j=E(e=n))&&w?w.p(t,e):(w.d(1),(w=j(e))&&(w.c(),w.m(c.parentNode,c))),N.ctx=e,"gpspromise"in t&&s!==(s=e.gpspromise)&&F(s,N),e.error?O?O.p(t,e):((O=I(e)).c(),O.m(m.parentNode,m)):O&&(O.d(1),O=null),t.selectedtrack||t.tracks||t.trackpromise){P=e.tracks;for(var r=0;r<P.length;r+=1){const n=U(e,P,r);A[r]?A[r].p(t,n):(A[r]=X(n),A[r].c(),A[r].m($,null))}for(;r<A.length;r+=1)A[r].d(1);A.length=P.length}if(t.selectedevent||t.events||t.confirmpromise){L=e.events;for(r=0;r<L.length;r+=1){const n=J(e,L,r);z[r]?z[r].p(t,n):(z[r]=nt(n),z[r].c(),z[r].m(T,null))}for(;r<z.length;r+=1)z[r].d(1);z.length=L.length}},i:t,o:t,d(t){t&&(i(n),i(r)),w.d(t),t&&(i(c),i(o)),N.block.d(),N.token=null,N=null,t&&i(f),O&&O.d(t),t&&(i(m),i(v),i(k),i(g)),u(A,t),t&&(i(x),i(_),i(C),i(S)),u(z,t)}}}function ct(t,e,n){let r,c,o,s,l,a,i,u,{name:d,tracks:f,events:p}=e,m=["192.168.1.6","192.168.1.8","192.168.1.7","172.20.10.2","172.20.10.3","172.20.10.4","172.20.10.5","172.20.10.6","172.20.10.7","172.20.10.8","172.20.10.9","172.20.10.10","172.20.10.11","172.20.10.12","172.20.10.13","172.20.10.14"],v=7,h=0,g=!1;function b(){n("error",g=!1);for(let t of m){let e="https://"+t+":5000";fetch(e).then(t=>t.json()).then(t=>{"ok"===t.status&&(r=e),n("backend",r)}).catch(t=>{console.log(t),n("error",g="Could not connect to tethered backend")})}}function y(t){n("error",g=!1),n("events",p=[]),n("selectedtrack",o=t),n("trackpromise",s=fetch(r+"/loxcheck",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c,track:t})}).then(t=>t.json()).then(t=>{n("events",p=t.events),i=t.lluid,u=t.myself}).catch(t=>{console.log(t),n("error",g="Error contacting livelox.com"),n("selectedtrack",o=!1)}))}function $(t){n("error",g=!1),n("confirmpromise",a=fetch(r+"/loxdone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c,classid:t,lluid:i,myself:u})}).then(t=>{}).catch(t=>{console.log(t),n("error",g="Error confirming livelox event upload")}))}return x(()=>{b()}),t.$set=(t=>{"name"in t&&n("name",d=t.name),"tracks"in t&&n("tracks",f=t.tracks),"events"in t&&n("events",p=t.events)}),{name:d,tracks:f,events:p,backend:r,fromdays:v,todays:h,selectedevent:void 0,selectedtrack:o,trackpromise:s,gpspromise:l,confirmpromise:a,error:g,getBackend:b,getTracks:function(){n("error",g=!1),n("tracks",f=[]),n("events",p=[]),n("gpspromise",l=fetch(r+"/tracks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromdays:v,todays:h})}).then(t=>t.json()).then(t=>{n("tracks",f=t.tracks),c=t.id}).catch(t=>{console.log(t),n("error",g="Could not fetch GPS data from watch")}))},checktrack:y,confirmTrackEvent:$,input0_input_handler:function(){v=k(this.value),n("fromdays",v)},input1_input_handler:function(){h=k(this.value),n("todays",h)},click_handler:function({track:t}){y(t.id)},click_handler_1:function({event:t}){$(t.id)}}}return new class extends G{constructor(t){super(),z(this,t,ct,rt,s,["name","tracks","events"])}}({target:document.body,props:{tracks:[],events:[]}})}();
//# sourceMappingURL=bundle.js.map
